<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>播放</title>
        <link rel="stylesheet" type="text/css" href="../../static/css/play-page/index.css" />
        <link rel="stylesheet" type="text/css" href="../../static/css/common.css" />
    </head>
    <body>
        <div id="app">
            <!-- 遮罩 -->
            <div class="masking" v-bind:style="{backgroundImage: 'url(' + currentMusic.surface + ')'}"></div>
            <div class="content">
                <!-- 顶部 -->
                <div class="player-row-1 space-between">
                    <img class="col-1" src="../../static/img/common/dropdown.png" alt="" />
                    <div class="col-2">
                        <div class="title">{{currentMusic.name}}</div>
                        <div class="album">{{currentMusic.album}}</div>
                    </div>
                    <img class="col-3" src="../../static/img/common/sharing.png" alt="" />
                </div>
                <!-- 唱片 -->
                <div class="player-row-2 flex flex-center">
                    <div class="film" style="display: none" v-bind:class="{'last-film': lastFilmAnimation}">
                        <img class="surface" v-bind:src="lastMusic.surface" />
                    </div>
                    <div
                        class="film"
                        v-bind:class="{
                            'from-current-to-next-film': fromCurrentToNextFilmAnimation,
                            'from-last-to-current-film': fromLastToCurrentFilmAnimation
                        }"
                    >
                        <img
                            class="surface"
                            v-bind:style="{transform: 'rotate(' + recordStatus.angle + 'deg)'}"
                            v-bind:src="currentMusic.surface"
                        />
                    </div>
                    <div class="film" style="display: none" v-bind:class="{'next-film': nextFilmAnimation}">
                        <img class="surface" v-bind:src="nextMusic.surface" />
                    </div>
                </div>
                <!-- 歌词 -->
                <div class="player-row-3">
                    Don't you know ?<br />
                    Don't you know life's so sweet ? <br />
                    きみの夢　どういうの？<br />
                    その瞳をのぞけば<br />
                </div>
                <!-- 操作 -->
                <div class="player-row-4">
                    <div class="row-1 flex space-between">
                        <img class="col-1" src="../../static/img/common/like.png" />
                        <img class="col-2" src="../../static/img/common/download.png" />
                        <img class="col-3" src="../../static/img/common/comments.png" />
                    </div>
                    <div class="row-2 flex space-between">
                        <div class="start-time">1:20</div>
                        <div class="processor"></div>
                        <div class="end-time">03:12</div>
                    </div>
                    <div class="row-3 flex space-between">
                        <img class="col-1" src="../../static/img/common/recycle.png" />
                        <img class="col-2" v-on:click="switchLastMusic" src="../../static/img/common/last.png" />
                        <img class="col-3" v-on:click="stopOrPlay" v-bind:src="actionIcon" />
                        <img class="col-4" v-on:click="switchNextMusic" src="../../static/img/common/next.png" />
                        <img
                            class="drop-or-down-music-list"
                            v-on:click="dropOrDownMusicList"
                            src="../../static/img/common/play-list(1).png"
                        />
                    </div>
                    <audio style="display: none" ref="audio" v-bind:src="getCurrentMusic().musicSrc"></audio>
                </div>
            </div>
            <!-- 音乐列表 -->
            <div class="music-list" v-bind:class="{'dropup-list': dropupList, 'dropdown-list': dropdownList}">
                <div class="menu flex flex-end">
                    <img
                        v-on:click="dropOrDownMusicList"
                        style="width: 4vw; height: 4vw; margin: 1.5vw 0"
                        src="../../static/img/common/close.png"
                    />
                </div>
                <div class="title flex space-between">
                    <div class="title-1">歌曲名</div>
                    <div class="title-2">专辑</div>
                    <div class="title-3">时长</div>
                </div>
                <div
                    class="music-item flex space-between"
                    v-bind:class="{'playing-music': index == musicStatus.sequence ? true : false}"
                    v-for="(item, index) in musics"
                    :key="index"
                >
                    <div class="col-1">{{item.name}}</div>
                    <div class="col-2">{{item.album}}</div>
                    <div class="col-3">{{item.endTime}}</div>
                </div>
            </div>
        </div>
        <script src="https://unpkg.com/vue@next"></script>
        <script>
            /**
             * @description：基于Vue框架实现音乐播放器
             * @preview：https://shiramashiro.github.io/web-training/on-self/src/play-page/index.html
             * @author：郑人滏
             */

            const app = {
                data() {
                    // ICON地址
                    const ICON_URL = {
                        STOPPED: 'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/stopped.png',
                        PLAYING: 'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/playing.png'
                    }
                    // 音乐列表
                    const musics = [
                        {
                            name: '秋绪',
                            album: '赛壬唱片-MSR',
                            startTime: 0,
                            endTime: 192,
                            musicSrc:
                                'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item01/%E5%A1%9E%E5%A3%AC%E5%94%B1%E7%89%87-MSR%2C%E3%82%BF%E3%82%A4%E3%83%8A%E3%82%AB%E5%BD%A9%E6%99%BA%20-%20%E7%A7%8B%E7%BB%AA.mp3',
                            surface: 'https://p2.music.126.net/AuJtKCWhFMIE17igpXBPPA==/109951165379323215.jpg?param=130y130'
                        },
                        {
                            name: 'I really ∞',
                            album: '我真的真的真的真的',
                            startTime: 0,
                            endTime: 135,
                            musicSrc:
                                'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item03/warma%2CCrazy%20Bucket%20%E9%99%88%E6%A5%92%E6%BD%BC%20-%20I%20really%20%E2%88%9E%EF%BC%88%E7%BF%BB%E8%87%AA%20Carly%20Rae%20Jepsen%EF%BC%89.mp3',
                            surface: 'https://p2.music.126.net/DwWVQH2lsnqJEpeUiNaCZA==/109951164416460276.jpg?param=130y130'
                        },
                        {
                            name: '我家有蜘蛛！！！',
                            album: '我家有蜘蛛！！！',
                            startTime: 0,
                            endTime: 144,
                            musicSrc:
                                'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item02/warma%20-%20%E6%88%91%E5%AE%B6%E9%87%8C%E6%9C%89%E8%9C%98%E8%9B%9B%EF%BC%81%EF%BC%81%EF%BC%81.mp3',
                            surface: 'https://p2.music.126.net/z_Mf8OfATNV2O-4V0eub1Q==/109951164255539403.jpg?param=130y130'
                        }
                    ]

                    let recordStatus = {
                            gap: '',
                            angle: 0
                        },
                        musicStatus = {
                            sequence: 0,
                            condition: true
                        }
                    let lastMusic = {},
                        currentMusic = {},
                        nextMusic = {}
                    let actionIcon = ICON_URL.STOPPED

                    lastMusic.surface = musics[musics.length - 1].surface
                    currentMusic.surface = musics[0].surface
                    nextMusic.surface = musics[1].surface

                    return {
                        musics, // 歌曲列表数组
                        lastMusic, // 上一首歌曲对象
                        currentMusic, // 当前歌曲对象
                        nextMusic, // 下一首歌曲对象
                        recordStatus, // 唱片的状态
                        musicStatus, // 歌曲的状态
                        actionIcon, // 播放或暂停按钮的图片地址
                        ICON_URL, // 播放或暂停的暂停图片地址和播放图片地址
                        dropdownList: false,
                        dropupList: false,
                        lastFilmAnimation: false,
                        fromCurrentToNextFilmAnimation: false, // 从当前歌曲到下一首歌曲的动画
                        fromLastToCurrentFilmAnimation: false, // 从上一首到当前歌曲的动画
                        nextFilmAnimation: false // 下首歌曲播放动画
                    }
                },
                methods: {
                    // 是否为最后一首歌
                    isLastMusic() {
                        return this.musicStatus.sequence == this.musics.length - 1 ? true : false
                    },

                    // 是否为第一首歌
                    isFirstMusic() {
                        return this.musicStatus.sequence == 0 ? true : false
                    },

                    // 当前歌曲是否正在播放
                    isPlaying() {
                        return this.musicStatus.condition == true ? true : false
                    },

                    // 开启或结束下一首歌曲的播放动画
                    setNextFilmAnimation(bool) {
                        this.fromCurrentToNextFilmAnimation = bool
                        this.nextFilmAnimation = bool
                    },

                    // 开启或结束上一首歌曲的播放动画
                    setLastFilmAnimation(bool) {
                        this.fromLastToCurrentFilmAnimation = bool
                        this.lastFilmAnimation = bool
                    },

                    // 暂停歌曲
                    stopMusic() {
                        this.musicStatus.condition = false
                        this.actionIcon = this.ICON_URL.STOPPED
                        clearInterval(this.recordStatus.gap)
                    },

                    // 播放歌曲
                    playMusic() {
                        this.musicStatus.condition = true
                        this.actionIcon = this.ICON_URL.PLAYING
                        this.rotateFilm()
                    },

                    // 重置唱片角度
                    resetRecordAngle() {
                        this.recordStatus.angle = 0
                    },

                    // 重置歌曲索引
                    resetMusicSequenceToFirst() {
                        this.musicStatus.sequence = 0
                    },

                    resetMusicSequenceToLast() {
                        this.musicStatus.sequence = this.musics.length - 1
                    },

                    // 获取上一首歌曲
                    getLastMusic() {
                        if (this.isFirstMusic()) {
                            return this.musics[this.musics.length - 1]
                        } else {
                            return this.musics[this.musicStatus.sequence - 1]
                        }
                    },

                    // 获取当前歌曲
                    getCurrentMusic() {
                        return this.musics[this.musicStatus.sequence]
                    },

                    // 获取下一首歌曲
                    getNextMusic() {
                        if (this.isLastMusic()) {
                            return this.musics[0]
                        } else {
                            return this.musics[this.musicStatus.sequence + 1]
                        }
                    },

                    /**
                     * 旋转唱片
                     */
                    rotateFilm() {
                        let _this = this
                        _this.recordStatus.gap = setInterval(() => {
                            if (_this.recordStatus.angle == 360) _this.recordStatus.angle = 0
                            _this.recordStatus.angle++
                        }, 20)
                    },

                    /**
                     * 播放或暂停
                     */
                    stopOrPlay() {
                        if (this.isPlaying()) {
                            this.$refs.audio.pause() // 暂停播放
                            this.stopMusic()
                        } else {
                            this.$refs.audio.play() // 开始播放
                            this.playMusic()
                        }
                    },

                    /**
                     * 播放下一首歌曲
                     */
                    switchNextMusic() {
                        let _this = this
                        if (_this.isPlaying()) _this.stopMusic()
                        _this.nextMusic = _this.getNextMusic() // 在播放歌曲的动画之前，重新赋予nextMusic所存储的数据
                        _this.setNextFilmAnimation(true)
                        setTimeout(() => {
                            _this.resetRecordAngle()
                            _this.setNextFilmAnimation(false)
                            _this.currentMusic = _this.getCurrentMusic() // 将当前的背景和歌曲资源都赋值到currentFilmBg
                        }, 1200)
                        if (_this.isLastMusic()) {
                            _this.resetMusicSequenceToFirst()
                        } else {
                            _this.musicStatus.sequence++ // 自增歌曲索引值
                        }
                    },

                    /**
                     * 播放上一首歌曲
                     */
                    switchLastMusic() {
                        let _this = this
                        if (_this.isPlaying()) {
                            _this.stopMusic()
                        }
                        _this.lastMusic = _this.getLastMusic() // 在播放歌曲的动画之前，重新赋予lastMusic所存储的数据
                        _this.setLastFilmAnimation(true)
                        setTimeout(() => {
                            _this.resetRecordAngle()
                            _this.setLastFilmAnimation(false)
                            _this.currentMusic = _this.getCurrentMusic() // 将当前的背景和歌曲资源都赋值到currentFilmBg
                        }, 1200)
                        if (_this.isFirstMusic()) {
                            _this.resetMusicSequenceToLast()
                        } else {
                            _this.musicStatus.sequence-- // 自减歌曲索引值
                        }
                    },

                    dropOrDownMusicList() {
                        if (!this.dropdownList) {
                            this.dropdownList = true
                        } else {
                            this.dropdownList = false
                            this.dropupList = true
                            setTimeout(() => {
                                this.dropupList = false
                            }, 800)
                        }
                    }
                }
            }

            Vue.createApp(app).mount('#app')
        </script>
    </body>
</html>
