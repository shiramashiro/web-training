<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>播放</title>
        <link rel="stylesheet" type="text/css" href="../../static/css/play-page/index.css" />
        <link rel="stylesheet" type="text/css" href="../../static/css/common.css" />
    </head>
    <body>
        <!--
            @description：基于Vue框架实现音乐播放器
            @preview：https://shiramashiro.github.io/web-training/on-self/src/play-page/index.html
            @since：2021年9月16日10:55:09
            @author：郑人滏
        -->
        <div id="app">
            <!-- 遮罩 -->
            <div class="masking" v-bind:style="{backgroundImage: 'url(' + currentMusic.surface + ')'}"></div>
            <div class="content">
                <!-- 顶部 -->
                <div class="player-row-1 space-between">
                    <img class="col-1" src="../../static/img/common/dropdown.png" alt="" />
                    <div class="col-2">
                        <div class="title">{{currentMusic.name}}</div>
                        <div class="album">{{currentMusic.album}}</div>
                    </div>
                    <img class="col-3" src="../../static/img/common/sharing.png" alt="" />
                </div>
                <!-- 唱片 -->
                <div class="player-row-2 flex flex-center">
                    <div class="film" style="display: none" v-bind:class="{'last-film': lastFilmAnimation}">
                        <img class="surface" v-bind:src="lastMusic.surface" />
                    </div>
                    <div
                        class="film"
                        v-bind:class="{
                            'from-current-to-next-film': fromCurrentToNextFilmAnimation,
                            'from-last-to-current-film': fromLastToCurrentFilmAnimation
                        }"
                    >
                        <img
                            class="surface"
                            v-bind:style="{transform: 'rotate(' + recordStatus.angle + 'deg)'}"
                            v-bind:src="currentMusic.surface"
                        />
                    </div>
                    <div class="film" style="display: none" v-bind:class="{'next-film': nextFilmAnimation}">
                        <img class="surface" v-bind:src="nextMusic.surface" />
                    </div>
                </div>
                <!-- 歌词 -->
                <div class="player-row-3">
                    Don't you know ?<br />
                    Don't you know life's so sweet ? <br />
                    きみの夢　どういうの？<br />
                    その瞳をのぞけば<br />
                </div>
                <!-- 操作 -->
                <div class="player-row-4">
                    <div class="row-1 flex space-between">
                        <img class="col-1" src="../../static/img/common/like.png" />
                        <img class="col-2" src="../../static/img/common/download.png" />
                        <img class="col-3" src="../../static/img/common/comments.png" />
                    </div>
                    <div class="row-2 flex space-between">
                        <div class="start-time">1:20</div>
                        <div class="processor"></div>
                        <div class="end-time">03:12</div>
                    </div>
                    <div class="row-3 flex space-between">
                        <img class="col-1" src="../../static/img/common/recycle.png" />
                        <img class="col-2" v-on:click="switchLastMusic" src="../../static/img/common/last.png" />
                        <img class="col-3" v-on:click="stopOrPlay" v-bind:src="actionIcon" />
                        <img class="col-4" v-on:click="switchNextMusic" src="../../static/img/common/next.png" />
                        <img
                            class="drop-or-down-music-list"
                            v-on:click="dropOrDownMusicList"
                            src="../../static/img/common/play-list(1).png"
                        />
                    </div>
                    <audio style="display: none" ref="audio" v-bind:src="currentMusic.musicSrc"></audio>
                </div>
            </div>
            <!-- 音乐列表 -->
            <div class="music-list" v-bind:class="{'dropup-list': dropupList, 'dropdown-list': dropdownList}">
                <div class="menu flex flex-end">
                    <img
                        v-on:click="dropOrDownMusicList"
                        style="width: 4vw; height: 4vw; margin: 1.5vw 0"
                        src="../../static/img/common/close.png"
                    />
                </div>
                <div class="title flex space-between">
                    <div class="title-1">歌曲名</div>
                    <div class="title-2">专辑</div>
                    <div class="title-3">时长</div>
                </div>
                <div
                    class="music-item flex space-between"
                    v-bind:class="{'playing-music': index == musicStatus.sequence ? true : false}"
                    v-for="(item, index) in musics"
                    :key="index"
                >
                    <div class="col-1">{{item.name}}</div>
                    <div class="col-2">{{item.album}}</div>
                    <div class="col-3">{{item.endTime}}</div>
                </div>
            </div>
        </div>
        <script src="https://unpkg.com/vue@next"></script>
        <script>
            const app = {
                mounted() {
                    console.log(
                        '@description：基于Vue框架实现音乐播放器\n' +
                            '@preview：https://shiramashiro.github.io/web-training/on-self/src/play-page/index.html\n' +
                            '@author: 郑人滏'
                    )
                },
                data() {
                    // ICON地址
                    const ICON_URL = {
                        STOPPED: 'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/stopped.png',
                        PLAYING: 'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/playing.png'
                    }

                    // 音乐列表
                    const musics = [
                            {
                                name: '秋绪',
                                album: '赛壬唱片-MSR',
                                startTime: 0,
                                endTime: 192,
                                musicSrc:
                                    'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item01/%E7%A7%8B%E7%BB%AA.mp3',
                                surface: 'https://p2.music.126.net/AuJtKCWhFMIE17igpXBPPA==/109951165379323215.jpg?param=130y130'
                            },
                            {
                                name: 'I really ∞',
                                album: '我真的真的真的真的',
                                startTime: 0,
                                endTime: 135,
                                musicSrc:
                                    'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item02/I%20really%20%E2%88%9E.mp3',
                                surface: 'https://p2.music.126.net/DwWVQH2lsnqJEpeUiNaCZA==/109951164416460276.jpg?param=130y130'
                            },
                            {
                                name: 'Splashing Star',
                                album: '崩坏3-Alive-Original Soundtrack',
                                lyrics: `存音乐，请尽情欣赏`,
                                startTime: 0,
                                endTime: 144,
                                musicSrc:
                                    'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item03/HOYO-MiX%20-%20Splashing%20Star.mp3',
                                surface: 'https://p1.music.126.net/eo1oYY1OQobITrvSNf_nrA==/109951165705882625.jpg?param=130y130'
                            },
                            {
                                name: '壶中洞天',
                                album: '陈致逸 / HOYO-MiX /《原神》璃月篇OST',
                                lyrics: `存音乐，请尽情欣赏`,
                                startTime: 0,
                                endTime: 174,
                                musicSrc:
                                    'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item04/%E5%A3%B6%E4%B8%AD%E6%B4%9E%E5%A4%A9.mp3',
                                surface: 'https://p1.music.126.net/yoRaxBY77koSqhjh52g-DA==/109951165434255510.jpg?param=130y130'
                            }
                        ],
                        maxMusicLength = musics.length - 1

                    let recordStatus = {
                            gap: '',
                            angle: 0
                        },
                        musicStatus = {
                            sequence: 0,
                            condition: true
                        }

                    let lastMusic = {},
                        currentMusic = {},
                        nextMusic = {}

                    let actionIcon = ICON_URL.STOPPED

                    lastMusic.surface = musics[maxMusicLength].surface
                    currentMusic = musics[0]
                    nextMusic.surface = musics[1].surface

                    return {
                        musics, // 歌曲列表数组
                        lastMusic, // 上一首歌曲对象
                        currentMusic, // 当前歌曲对象
                        nextMusic, // 下一首歌曲对象
                        recordStatus, // 唱片的状态
                        musicStatus, // 歌曲的状态
                        actionIcon, // 播放或暂停按钮的图片地址
                        ICON_URL, // 播放或暂停的暂停图片地址和播放图片地址
                        maxMusicLength,
                        dropdownList: false,
                        dropupList: false,
                        lastFilmAnimation: false,
                        fromCurrentToNextFilmAnimation: false, // 从当前歌曲到下一首歌曲的动画
                        fromLastToCurrentFilmAnimation: false, // 从上一首到当前歌曲的动画
                        nextFilmAnimation: false // 下首歌曲播放动画
                    }
                },
                methods: {
                    // 是否为最后一首歌
                    isLastMusic() {
                        return this.musicStatus.sequence == this.maxMusicLength
                    },

                    // 是否为第一首歌
                    isFirstMusic() {
                        return this.musicStatus.sequence == 0
                    },

                    // 当前歌曲是否正在播放
                    isPlaying() {
                        return this.musicStatus.condition
                    },

                    // 开启或结束切换下一首歌曲时的平移动画
                    setNextFilmAnimation(bool) {
                        this.fromCurrentToNextFilmAnimation = bool
                        this.nextFilmAnimation = bool
                    },

                    // 开启或结束切换上一首歌曲时的平移动画
                    setLastFilmAnimation(bool) {
                        this.fromLastToCurrentFilmAnimation = bool
                        this.lastFilmAnimation = bool
                    },

                    // 暂停歌曲
                    stopMusic() {
                        this.musicStatus.condition = false
                        this.actionIcon = this.ICON_URL.STOPPED
                        clearInterval(this.recordStatus.gap)
                    },

                    // 播放歌曲
                    playMusic() {
                        this.musicStatus.condition = true
                        this.actionIcon = this.ICON_URL.PLAYING
                        this.rotateFilm()
                    },

                    // 重置唱片角度
                    resetRecordAngle() {
                        this.recordStatus.angle = 0
                    },

                    /**
                     * 设置上一首唱片，并改变中间的唱片为要播放的歌曲。
                     *
                     * 如果最后一首歌，@variable lastMusic 为最后一首歌。否则，@variable lastMusic 为上一首歌。
                     */
                    setLastMusic() {
                        if (this.isFirstMusic()) {
                            // 改变待切换的唱片
                            this.lastMusic = this.musics[this.maxMusicLength]
                            // 歌曲的索引值指向最后一首歌曲
                            this.musicStatus.sequence = this.maxMusicLength
                        } else {
                            // 改变待切换的唱片
                            this.lastMusic = this.musics[this.musicStatus.sequence - 1]
                            // 歌曲的索引值指向下一首歌曲
                            this.musicStatus.sequence--
                        }
                    },

                    // 改变中间的唱片
                    setCurrentMusic() {
                        this.currentMusic = this.musics[this.musicStatus.sequence]
                    },

                    /**
                     * 设置下一首唱片，并改变中间的唱片为要播放的歌曲。
                     *
                     * 如果最后一首歌，@variable nextMusic 为第一首歌。否则，@variable nextMusic 为下一首歌。
                     */
                    setNextMusic() {
                        if (this.isLastMusic()) {
                            // 改变待切换的唱片
                            this.nextMusic = this.musics[0]
                            // 歌曲的索引值指向第一首歌曲
                            this.musicStatus.sequence = 0
                        } else {
                            // 改变待切换的唱片
                            this.nextMusic = this.musics[this.musicStatus.sequence + 1]
                            // 歌曲的索引值自加1
                            this.musicStatus.sequence++
                        }
                    },

                    /**
                     * 旋转唱片
                     */
                    rotateFilm() {
                        let _this = this
                        _this.recordStatus.gap = setInterval(() => {
                            if (_this.recordStatus.angle == 360) _this.recordStatus.angle = 0
                            _this.recordStatus.angle++
                        }, 20)
                    },

                    /**
                     * 播放或暂停
                     */
                    stopOrPlay() {
                        if (this.isPlaying()) {
                            this.$refs.audio.pause() // 暂停播放
                            this.stopMusic()
                        } else {
                            this.$refs.audio.play() // 开始播放
                            this.playMusic()
                        }
                    },

                    /**
                     * 播放下一首歌曲
                     */
                    switchNextMusic() {
                        let _this = this
                        _this.stopMusic()
                        _this.setNextMusic()
                        _this.setNextFilmAnimation(true)
                        setTimeout(() => {
                            _this.resetRecordAngle()
                            _this.setNextFilmAnimation(false)
                            _this.setCurrentMusic()
                        }, 1000)
                    },

                    /**
                     * 播放上一首歌曲
                     */
                    switchLastMusic() {
                        let _this = this
                        _this.stopMusic()
                        _this.setLastMusic()
                        _this.setLastFilmAnimation(true)
                        setTimeout(() => {
                            _this.resetRecordAngle()
                            _this.setLastFilmAnimation(false)
                            _this.setCurrentMusic()
                        }, 1000)
                    },

                    dropOrDownMusicList() {
                        if (!this.dropdownList) {
                            this.dropdownList = true
                        } else {
                            this.dropdownList = false
                            this.dropupList = true
                            setTimeout(() => {
                                this.dropupList = false
                            }, 500)
                        }
                    }
                }
            }

            Vue.createApp(app).mount('#app')
        </script>
    </body>
</html>
