<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>播放</title>
        <link rel="stylesheet" type="text/css" href="../../static/css/play-page/index.css" />
        <link rel="stylesheet" type="text/css" href="../../static/css/common.css" />
    </head>
    <body>
        <div id="app">
            <div id="container">
                <div class="masking" v-bind:style="{backgroundImage: 'url(' + currentMusic.filmAndBg + ')'}"></div>
                <div class="content">
                    <div class="pp-row-1 pp-flex space-between">
                        <img class="icon" src="../../static/img/common/dropdown.png" alt="" />
                        <div class="middle">
                            <div class="title">秋绪</div>
                            <div class="desc">赛壬唱片</div>
                        </div>
                        <img class="icon" src="../../static/img/common/sharing.png" alt="" />
                    </div>
                    <div class="pp-row-2 flex center">
                        <div class="film" style="display: none">
                            <img class="cover" v-bind:src="getLastMusic().filmAndBg" />
                        </div>
                        <div class="film" v-bind:class="{'current-film': currentFilmAnimation}">
                            <img
                                class="cover"
                                v-bind:style="{transform: 'rotate(' + recordStatus.angle + 'deg)'}"
                                v-bind:src="currentMusic.filmAndBg"
                            />
                        </div>
                        <div class="film" style="display: none" v-bind:class="{'next-film': nextFilmAnimation}">
                            <img class="cover" v-bind:src="nextMusic.filmAndBg" />
                        </div>
                    </div>
                    <div class="pp-row-3">
                        Don't you know ?<br />
                        Don't you know life's so sweet ? <br />
                        きみの夢　どういうの？<br />
                        その瞳をのぞけば<br />
                    </div>
                    <div class="pp-row-4">
                        <div class="row-1 flex space-between">
                            <img src="../../static/img/common/like.png" class="col-1" />
                            <img src="../../static/img/common/download.png" class="col-2" />
                            <img src="../../static/img/common/comments.png" class="col-3" />
                        </div>
                        <div class="row-2 flex space-between">
                            <div class="start-time">1:20</div>
                            <div class="processor"></div>
                            <div class="end-time">03:12</div>
                        </div>
                        <div class="row-3 flex space-between">
                            <img src="../../static/img/common/recycle.png" alt="" />
                            <img src="../../static/img/common/last.png" alt="" />
                            <img v-on:click="action" class="play-btn" v-bind:src="actionIcon" alt="" />
                            <img v-on:click="switchNextMusic" src="../../static/img/common/next.png" alt="" />
                            <img src="../../static/img/common/play-list(1).png" alt="" />
                        </div>
                        <audio style="display: none" ref="audio" v-bind:src="getCurrentMusic().musicSrc"></audio>
                    </div>
                </div>
            </div>
        </div>
        <script src="https://unpkg.com/vue@next"></script>
        <script>
            const app = {
                data() {
                    let ACTION_ICON = {
                        STOPPED: 'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/stopped.png',
                        PLAYING: 'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/playing.png'
                    }

                    let musics = [
                        {
                            name: '秋绪',
                            album: '赛壬唱片-MSR',
                            startTime: 0,
                            endTime: 192,
                            musicSrc:
                                'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item01/%E5%A1%9E%E5%A3%AC%E5%94%B1%E7%89%87-MSR%2C%E3%82%BF%E3%82%A4%E3%83%8A%E3%82%AB%E5%BD%A9%E6%99%BA%20-%20%E7%A7%8B%E7%BB%AA.mp3',
                            filmAndBg: 'https://p2.music.126.net/AuJtKCWhFMIE17igpXBPPA==/109951165379323215.jpg?param=130y130'
                        },
                        {
                            name: 'I really ∞',
                            album: '我真的真的真的真的',
                            startTime: 0,
                            endTime: 135,
                            musicSrc:
                                'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item03/warma%2CCrazy%20Bucket%20%E9%99%88%E6%A5%92%E6%BD%BC%20-%20I%20really%20%E2%88%9E%EF%BC%88%E7%BF%BB%E8%87%AA%20Carly%20Rae%20Jepsen%EF%BC%89.mp3',
                            filmAndBg: 'https://p2.music.126.net/DwWVQH2lsnqJEpeUiNaCZA==/109951164416460276.jpg?param=130y130'
                        },
                        {
                            name: '我家有蜘蛛！！！',
                            album: '我家有蜘蛛！！！',
                            startTime: 0,
                            endTime: 144,
                            musicSrc:
                                'https://generic-data.oss-cn-chengdu.aliyuncs.com/img/training/music/item02/warma%20-%20%E6%88%91%E5%AE%B6%E9%87%8C%E6%9C%89%E8%9C%98%E8%9B%9B%EF%BC%81%EF%BC%81%EF%BC%81.mp3',
                            filmAndBg: 'https://p2.music.126.net/z_Mf8OfATNV2O-4V0eub1Q==/109951164255539403.jpg?param=130y130'
                        }
                    ]

                    let recordStatus = {
                        gap: '',
                        angle: 0
                    }

                    let musicStatus = {
                        sequence: 0,
                        isPlaying: true,
                        currentMusic: false,
                        hasNextMusic: false
                    }

                    let currentMusic = {}
                    let nextMusic = {}

                    let actionIcon = ACTION_ICON.STOPPED

                    let nextFilmBg = musics[1].filmAndBg

                    currentMusic.filmAndBg = musics[0].filmAndBg
                    nextMusic.filmAndBg = musics[1].filmAndBg

                    return {
                        ACTION_ICON, // 播放或暂停的暂停图片地址和播放图片地址
                        musics, // 歌曲列表数组
                        nextMusic, // 下首歌曲对象
                        currentMusic, // 当前歌曲对象
                        recordStatus, // 唱片的状态
                        musicStatus, // 歌曲的状态
                        actionIcon, // 播放或暂停按钮的图片地址
                        currentFilmAnimation: false, // 当前歌曲播放动画
                        nextFilmAnimation: false, // 下首歌曲播放动画
                        lastFilmAnimation: false // 上首歌曲播放动画
                    }
                },
                methods: {
                    /**
                     * 获取上一个音乐
                     */
                    getLastMusic() {
                        if (this.musicStatus.sequence == 0) {
                            return this.musics[this.musics.length - 1]
                        } else {
                            return this.musics[this.musicStatus.sequence - 1]
                        }
                    },
                    getCurrentMusic() {
                        return this.musics[this.musicStatus.sequence]
                    },
                    /**
                     * 获取下一个音乐
                     */
                    getNextMusic() {
                        if (this.musicStatus.sequence == this.musics.length - 1) {
                            return this.musics[0]
                        } else {
                            return this.musics[this.musicStatus.sequence + 1]
                        }
                    },
                    /**
                     * 旋转唱片
                     */
                    rotate() {
                        let _this = this
                        _this.recordStatus.gap = setInterval(() => {
                            if (_this.recordStatus.angle == 360) _this.recordStatus.angle = 0
                            _this.recordStatus.angle++
                        }, 20)
                    },
                    /**
                     * 播放或暂停按钮
                     */
                    action() {
                        if (this.musicStatus.isPlaying) {
                            this.$refs.audio.pause() // 使audio标签暂停播放
                            this.musicStatus.isPlaying = false // 状态改为停止播放
                            this.actionIcon = this.ACTION_ICON.STOPPED // 暂停按钮
                            clearInterval(this.recordStatus.gap) // 清除Interval
                        } else {
                            this.$refs.audio.play() // 使audio标签开始播放
                            this.musicStatus.isPlaying = true // 状态改为开始播放
                            this.actionIcon = this.ACTION_ICON.PLAYING // 播放按钮
                            this.rotate() // 旋转胶片
                        }
                    },
                    /**
                     * 播放下一首歌曲
                     */
                    switchNextMusic() {
                        let _this = this
                        if (_this.musicStatus.isPlaying) {
                            _this.musicStatus.isPlaying = false
                            clearInterval(this.recordStatus.gap)
                        }
                        _this.actionIcon = _this.ACTION_ICON.STOPPED // 由播放按钮变为暂停按钮
                        _this.nextMusic = this.getNextMusic() // 在播放歌曲的动画之前，重新赋予nextMusic所存储的数据
                        _this.currentFilmAnimation = true // 播放当前歌曲的动画
                        _this.nextFilmAnimation = true // 播放下首歌曲的动画
                        setTimeout(() => {
                            _this.recordStatus.angle = 0 // 重置唱片的角度
                            _this.currentFilmAnimation = false // 关闭当前歌曲的动画
                            _this.nextFilmAnimation = false // 关闭下首歌曲的动画
                            _this.currentMusic = this.getCurrentMusic() // 将当前的背景和歌曲资源都赋值到currentFilmBg
                        }, 1200)
                        if (_this.musicStatus.sequence == _this.musics.length - 1) {
                            _this.musicStatus.sequence = 0
                        } else {
                            _this.musicStatus.sequence++ // 歌曲索引值自增
                        }
                    },
                    /**
                     * 播放上一首歌曲
                     */
                    lastMusic() {}
                }
            }

            Vue.createApp(app).mount('#app')
        </script>
    </body>
</html>
